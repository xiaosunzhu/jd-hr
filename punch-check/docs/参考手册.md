## Punch Check 参考手册 ##
版本：0.1.*  
Copyright 2015 yijun.sun
********************************************************************

### 运行环境 ###
操作系统：Windows7（32bit/64bit）  
系统语言：中文（简体，中国）*

*：必须严格满足的条件
>*调整系统语言：控制面板-区域和语言-格式-中文（简体，中国）-应用*
********************************************************************

### 结构说明 ###
	|
	|--config                     配置（不可修改目录名）
		|--表格配置.ini                输入表格参数配置文件（不可修改文件名)
		|--排班代码配置.ini             排班代码及时间段配置文件（不可修改文件名)
		|--数据配置.ini                基础运行参数配置文件（不可修改文件名)
    |
	|--punch_check.exe            运行程序
	|
	|--library.zip                其他运行库（不可修改文件名和内容）
	|--w9xpopen.exe               其他运行库（不可修改文件名和内容）
	|
	|--排班打卡比对_XXXX年X月.xls   输出文件（初始没有该文件，不是运行必须，运行后相同年月的输出会直接覆盖）

* **config（配置）**   
配置文件以“.ini”为后缀，放置于config目录下。  
配置文件中以#开头的行为说明部分  
配置文件基本格式：  
[配置段]  
配置项=值  
	>*注意：需要保证所有配置文件的编码格式不变。*

	各配置文件说明

	* **数据配置.ini**  
  		* “**Base**”配置段  （基础配置，**每次会变更**）  
  		  **年** = 当前年份，4位数字  
          **月** = 考勤月份  
          **起始月** = 考勤周期起始月份  
     	>*例如：4月考勤周期为3月21号-4月20号，月=4，起始月=3*  
  		* “**Swtiches**”配置段  （执行方式开关，值为数字，0表示关闭，1表示启用）  
          **全局排班** = 是否使用全局统一的排班代码配置。如果关闭，需要配置每个部门的排版代码。

	* **排班代码配置.ini**  
    	>*参考配置文件的说明部分，并严格按照原有格式修改，注意所有符号（-,:等）均为英文输入法。*
  		* “请假”配置段  
          所有需要输出的假别需要在此列出。  
          格式为：代码 = 描述,起始时间-截止时间
  		* “Global”配置段  
          全局统一的排班代码配置。当“数据配置.ini”中的“全局排班”配置开启（=1）时生效。  
          格式为：代码 = 起始时间-截止时间
  		* 其他配置段
          当“数据配置.ini”中的“全局排班”配置关闭（=0）时生效。  
          具体格式详见配置文件中的说明。  
    	>*“请假”和“Global”配置段是固定的，其他配置段根据部门自行设定*

	* 表格配置.ini  
    	>*该配置仅在表格格式发生变化时才进行修改。*  
   
      Sheet = 处理第几个Sheet  
      其他配置项不做详细说明。  

* **punch\_check.exe（运行程序）**   
  程序运行入口。  
  运行方式一：**双击运行**。  
  运行方式二：打开“开始”，输出cmd回车进入命令行，输入“cd /D 程序所在目录”回车，输入punch\_check（或者p然后Tab）回车。  
  当提示输入“排班表”时，拖拽排班表文件到运行窗口中，点击运行窗口，键入回车。  
  当提示输入“打卡表”时，拖拽打卡表文件到运行窗口中，点击运行窗口，键入回车。  
  当提示“处理完毕”，表示处理成功，会生成一个Excel文件（排班打卡比对_XXXX年X月.xls）到当前目录。  
  如果运行窗口提示“程序异常！”，则说明处理失败，请联系开发者。（具体原因在“程序异常！”后面有提示，请将运行窗口中的所有内容发送到<dusunjun@126.com>）  
  根据提示键入回车退出运行窗口。
	>*运行过程中，如需要终止运行程序，组合按键 Ctrl+C ，根据提示键入回车即可。* 

* **排班打卡比对_XXXX年X月.xls（输出文件）**  
  该文件包含4个表格：  
	* “**考勤异常**”Sheet  
	  最终结果表，与“考勤异常表”近似，包含请假信息，不包含迟到早退异常。按照排班表人员的顺序排列。同一人员信息连续按时间顺序排列。  
      “排班链接”列：链接到该异常对应日期的排班上班信息行。
      “状态”列：没有内容。在一个人员某天既没有打上班又没有打下班卡时，会标记为红色背景，**可能是有排班表没有登记的请假**。
	* “**TimeInfo**”Sheet  
	  每个人每天的排班上班信息。按照排班表人员的顺序排列。同一人员信息连续按时间顺序排列。  
      “在班时间”列：不准确的上班持续时间，仅供参考。  
      “排班”列：绝对准确的当天排班，包括排班代码和时间段。  
      “异常信息”列：包括上班未打卡/下班未打卡/迟到/早退。没有异常的为空，有异常的行有背景色，未打卡为紫红色，迟到或早退为黄色，迟到或早退严重的情况为青色。**如果连续多行都有异常，或者是青绿色，则可能是打卡信息与排班信息不太匹配。**
      “详细链接”列：链接到“Details”Sheet中与当天异常相关的打卡信息附近行。
	* “**Details**”Sheet  
	  在“TimeInfo”Sheet出现异常信息的相关所有打卡记录，用于人工检查判定结果。按照排班表人员的顺序排列。同一人员信息连续按时间顺序排列。  
      “返回链接”列：如果是没有信息的人员，则链接到“NotPlan”Sheet；如果是打卡异常，则链接到“TimeInfo”Sheet。  
      “排班”列：非完全准确的打卡记录的排班划分，仅供参考。
	* “**NotPlan**”Sheet  
	  打卡表中有打卡记录但是排班表中没有任何排班信息的人员列表。按照排班表人员的顺序排列。  
      “详细链接”列链接到“Details”Sheet。
********************************************************************

### 处理文件要求 ###
* 排班表
  1. 人员ERP、姓名和部门是以列形式编写
  2. 保证所有人员均包含，并且保证ERP准确
  3. 排班日期是以行形式编写，并且是按照顺序从左到右排列的
  4. 排班代码符合“排班代码配置.ini”中的配置（统一采用大写英文字母，半角）
* 打卡表
  1. 人员ERP和姓名是以列形式编写
  2. 保证ERP和姓名准确（与排班表一致）
  3. 具有打卡日期列和时间列，日期和时间需要独立成2列
  4. 保证同一个人员的打卡记录按时间顺序排列
********************************************************************

### 常见异常处理 ###
* 无法打开数据配置 / 无法打开表格配置 / 无法打开排班代码配置  
  检查相应配置文件是否被删除。该异常会终止程序运行。
* 数据配置格式非法 / 表格配置格式非法 / 排班代码配置格式非法  
  检查相应配置文件的格式，注意中英文、半角输入法，数字字母，文件字符编码等。该异常会终止程序运行。
* 排班表中发现重复人员  
  检查排班表，根据提示，将无法区分的人员进行区分，同时将打卡表中的人员同样进行区分。该异常会终止程序运行。
* 打卡表的人员编号和姓名与排班表不符
  同一编号在排班表中对应的姓名和打卡表中对应的姓名不一致，需要检查并修正。该异常会终止程序运行。
* 无法写入表格文件。请确认已关闭该文件并且有操作权限
  可能是待输出的文件“排班打卡比对_XXXX年X月.xls”已被打开。该异常会终止程序运行。需要先关闭文件，再次运行程序。
* 排班表中发现未配置的排班代码  
  在排班代码配置中添加提示未配置的排班代码。该异常不影响程序运行，但未配置的排班会被忽略。